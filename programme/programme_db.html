<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>GISRUK Programme</title>
        <script type="text/javascript" src="./d3.min.js"></script>
       <!-- <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script> -->
         <link rel="stylesheet" type="text/css" href="programme.css" /> 
    </head>
    
    
    <body>
        
        <h1>Programme Database (Under Development)</h1>
        
        <form>
            Author name: <input type="text" name="name" id="name-form"><br/>
            Paper Title: <input type="text" name="title" id="title-form"><br/>
            Abstract: <input type="text" name="abstract" id="abstract-form">
        </form>
        
        <!-- Placeholder for the table -->
        <table>
            <tr>
                <th>#</th>
                <th>Authors</th>
                <th>Title</th>
                <th>Session</th>
                <th>Group</th>
                <th>Category</th>
                <th>Abstract</th>
            </tr>
        </table>
        
        
        
        <!-- The script below does the data stuff -->
        
        <script type="text/javascript">
            var dataset; // Global variable to represent the data           
            
            // Variables used to filter the data. These are bound to the input elements
            var filter_name = "";
            var filter_title = "";
            var filter_abstract = "";
            
            
            // Read the data. This is asynchronous, so all data handling should be done in the
            // callback function
            d3.json("./all_papers.json", function(error, data) {
                    if (error) {  //If error is not null, something went wrong.
                        console.log(error);  //Log the error.
                    } 

                    else {      //If no error, the file loaded correctly. 
                        dataset = data; // Once loaded, keep a reference to the data
                         
                        // *** Now call functions that reqiure the data ***
                        
                        // This one makes the table
                        populateTable();
                        

                        // This one binds inputs into the entry form to functions
                        // that change the data displayed in the table
                        bindForm();
                        
                    } // else
                    //console.log(dataset);
                    //console.log(d3.selectAll("div"))
                } // function
            ); // d3.csv
            
            /** Add relevant papers to the table */
            function populateTable() {
                
                // Not really sure how this works. Need to join rows, then columns.
                // See: https://github.com/mbostock/d3/wiki/Selections#data
                // and maybe: http://bost.ocks.org/mike/join/
                
                // Bind the rows to each line of data / json object (e.g. a paper)
                var tr = d3.select("table").selectAll("tr").data(dataset).enter().append("tr");
                
                // Add some fancy visualisation stuff to the rows
                tr.on("mouseover", function(d) {
                    //This will run whenever *any* bar is clicked
                    console.log(d);
                });
                
                // Now add data to each of the rows
                var td = tr.selectAll("td")
                    // Bind the data json object (a paper) to the number of <td> elements required
                    .data(function(d, i){
                        console.log("populatePaper:"+filter_name);
                        //if (d['authors'].indexOf(filter_name) > -1 ) {
                        //        return [d,d,d,d,d,d];
                        //}
                        //else {
                        //    return [0,0,0,0,0,0];
                        //}
                        return [d,d,d,d,d,d,d];
                    }) 
                    // Create new <td> elements for each datum
                    .enter().append("td")
                    // Populate the <td> with author, title, etc
                    .text(function(d, i){return paperInfo(d,i);});
                      //.text(function(d, i){return "AA";});
                
            } // List papers
            
            
            /** Return a row of html for the datum 'd' */
            function paperInfo(d, i){
                switch (i) {
                        case 0: return d['number'];
                        case 1: return d['authors'];
                        case 2: return d['title'];
                        case 3: return d['session'].substring(0,2); // Don't use session names yet
                        case 4: return d['groups'];
                        case 5: return d['category'];
                        case 6: return d['abstract'];
                        //default: return "no abstract yet";                        
                }// switch
                
//                var temp = [
//                        d['PaperNo'],
//                        d['authors'],
//                        d['title'],
//                        d['Group'],
//                        d['category'],
//                        "No abstract yet"
//                    ] ;
//                return temp;
            }
            
            /* Bind the user input form to functions that are executed each time there 
                is a chang in out of the text boxes
            */
            function bindForm() {
                
                // bind the author name
                d3.select("#name-form").on("input", function() {
                    filter_name = this.value;
                    populateTable();
                    console.log(this.value+"-"+filter_name);
                });
                
                // bind the paper title
                d3.select("#title-form").on("input", function() {
                    filter_title = this.value;
                    console.log(this.value);
                });
                
                // bind the abstract
                d3.select("#abstract-form").on("input", function() {
                    filter_abstract = this.value;
                    console.log(this.value);
                });

            }


        </script>
        

    </body>

</html
